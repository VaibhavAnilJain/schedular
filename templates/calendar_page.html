<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/main.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/main.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <link rel="stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/calendar_page.css') }}">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.14.0/jquery.validate.min.js"></script> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.14.0/jquery.validate.min.js"></script>
        <script>


            $.validator.addMethod("anyDate",
                function(value, element) {
                    return value.match(/^(0?[1-9]|1[012])(:[0-5]\d) [APap][mM]$/)
                },
                "Please enter the time in the valid format i.e hh:mm am/pm!"
            );

            $.validator.addMethod("endDate",
            function(value, element) {
            var startDate = $('#dateday').val();
            console.log(startDate);
            // var val=moment(value).format('YYYY-MM-DD');
            console.log("value="+value);
            return Date.parse(startDate) <= Date.parse(value) || (value == "");
            }, "End date must be after start date");


            $(function() {
              console.log("you entered here once");
            $("#newModalForm").validate({
              rules: {
               event_name: {
                  required: true,
                  minlength: 3
                },
                stTime:{
                  required:true,
                  anyDate: true
                },
                endTime:{
                  required:true,
                  anyDate: true
                },
                enddate_:{
                  required:true,
                  endDate:true
                }                // action: "required"
              },
              messages: {
                event_name: {
                  required: "Please enter some data",
                  minlength: "Your data must be at least 3 characters"
                }
                // action: "Please provide some data"
              }
            });
            });


            document.addEventListener('DOMContentLoaded', function() {
          
              var calendarEl = document.getElementById('calendar');
              var eventss = [];

              var number = parseInt('{{n}}');
              console.log(typeof number);

              myvar = '{{events|tojson}}';
           
              var parsed = JSON.parse(myvar);
              console.log(parsed);
              

              for(var i =0; i < number; i++) 
                {eventss.push( {title: parsed[i].title, start: parsed[i].start+'T'+parsed[i].startTime, end: parsed[i].end+'T'+parsed[i].endTime })}
              
              console.log(eventss);

              


              var calendar = new FullCalendar.Calendar(calendarEl, {
                height: 650,
                initialView: 'dayGridMonth',
                // initialDate: '2021-07-07',
                selectable: true,
                headerToolbar: {
                  left: 'prev,next today',
                  center: 'title',
                  right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                eventClick: function(info) {
                    //alert('Event: ' + moment(info.event.start).format('YYYY-MM-DD'));
                   
                    $("#myModalLabel3").text("Event: "+info.event.title); 
                   
                    $("#myModalLabel2").text("Date "+moment(info.event.start).format('YYYY-MM-DD'));
                    // $("#Description").text("Description: "+info.event.des);    //want to extract the description from the db
                    $("#events_descr").modal('show');
                    $("#stdate_").val(moment(info.event.start).format('YYYY-MM-DD'));
                    $("#title_").val(info.event.title);
                    var a = info.event.start;
                    $('#stTime_').val(moment(info.event.start).format('HH:mm'));
                    $('#eTime_').val(moment(info.event.end).format('HH:mm'));
                    $('#eDate_').val(moment(info.event.end).format('YYYY-MM-DD'));
                    console.log(moment(info.event.start).format('HH:mm:ss'));
                    
                },
                dateClick: function(info){
                  $("#myModalLabel").text("Add Events to "+info.dateStr); 
                  $("#exampleModalCenter").modal('show');
                 // $("#myModalLabel2").text("Date "+info.dateStr);
                  $("#dateday").val(info.dateStr);    // Setting the currrent date in an hidden field     
               },
                events:eventss                  // Adding list of dictionaries(events) to events
                
              });
          
              calendar.render();
            });

          </script>
    </head>
    <body>


      <div class="navcontainer">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
          <a class="navbar-brand" href={{url_for("index")}}>
          <img width="150px" height="60px"src="/static/logo.svg" style="position:relative;top:-25px">
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link" href={{ url_for('Logout') }} style="text-align: left;"><span class="glyphicon glyphicon-log-out">LogOut </span><span class="sr-only">(current)</span></a>
            </div>
          </div>
        </nav>
      </div>



      <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Add Event to </h4>
                </div>
                <form method="post" action="/getdata" id="newModalForm">
                    <div class="modal-body">
                        <div class="form-group">
                            <input class="form-control business_skill_id" type="hidden" name="id">
                            <input class="form-control business_skill_name" id="event_name" name="event_name" placeholder="Enter the Event" required>
                        </div>
                        <div class="form-group">
                            <input class="form-control business_skill_content" type="hidden" name="content">
                            <!-- <label for="heading">Enter program details</label> -->
                            <textarea class="form-control" id="business_skill_content"  name="content1"  placeholder="Enter the Description" rows="4" cols="50" ></textarea>
                        </div>
                      
                        <div class="radio">
                          Type of Events &nbsp;&nbsp;&nbsp;
                          <label class="radio-inline"><input type="radio" name="optradio" value="Indoor">Indoor</label>
                          <label class="radio-inline"><input type="radio" name="optradio" value="Outdoor">Outdoor</label>
                        </div>
                     
                        Enter start time &nbsp;&nbsp;&nbsp;&nbsp;
                          <div class="row">
                             <div class='col-sm-6'>
                                <div class="form-group">
                                   <div class='input-group date' id='datetimepicker3'>
                                      <input type='text' class="form-control" name="stTime">
                                      <span class="input-group-addon">
                                      <span class="glyphicon glyphicon-time"></span>
                                      </span>
                                   </div>
                                </div>
                             </div>
                             <!-- <script type="text/javascript">
                                $(function () {
                                    $('#datetimepicker3').datetimepicker({
                                        format: 'LT'
                                    });
                                });
                             </script> -->
                          </div>

                        <div class = "endDate">
                          <input type='date' class="form-control" id="enddate_" name="enddate_" required>
                        </div>
                        Enter end time &nbsp;&nbsp;&nbsp;&nbsp;
                          <div class="row">
                            <div class='col-sm-6'>
                               <div class="form-group">
                                  <div class='input-group date' id='datetimepicker3'>
                                     <input type='text' class="form-control" name="endTime" >
                                     <span class="input-group-addon">
                                     <span class="glyphicon glyphicon-time"></span>
                                     </span>
                                  </div>
                               </div>
                              </div>
                         </div>
                         <div class = "datte">
                          <input type='hidden' class="form-control" id="dateday" name="dt" >

                         </div>
                    <div class="modal-footer">
                    
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                  </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Model 2 starts from here for deletion of events -->
    <div class="modal fade" id="events_descr" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  
                  <h3 class="modal-title1" id="myModalLabel3"></h3>
                 
              </div>
              <form method="post" action="/deleteData">
                  <div class="modal-body">
                  
                    
                       <h4 class="modal-title1" id="myModalLabel2"></h4>
                       <h6 class="modal-title1" id="Description"></h6>
                       <div class = "startDate_">
                        <input type='hidden' class="form-control" id="stdate_" name="stdate_" >
                       </div>
                       <div class = "titlee">
                        <input type='hidden' class="form-control" id="title_" name="title_" >

                       </div>
                       <div class = "startTime_">
                        <input type='hidden' class="form-control" id="stTime_" name="stTime_" >
                       </div>
                       <div class = "endTime_">
                        <input type='hidden' class="form-control" id="eTime_" name="eTime_" >
                       </div>
                       <div class = "endDate_">
                        <input type='hidden' class="form-control" id="eDate_" name="eDate_" >
                       </div>
                  <div class="modal-footer">
                  
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      <button type="submit" class="btn btn-primary">Delete Event</button>
                  </div>
                </div>
              </form>
          </div>
        </div>
    </div>

        
        <!-- <h1> Welcome!'{{n}}'</h1> -->
        <div class="container">
          <div class="calWeather">
          <div id="calendar" ></div>
          <div class = "weather_" id="weatherData">
            <div class="weatherImg">
              <br><br>
            Temperature<p>{{weatherData.temp}}&degC</p> 
            Feels Like<p>{{weatherData.feels_like}}&degC</p>
            Weather<p>{{weatherData.weather}}</p>   <img src = http://openweathermap.org/img/w/{{weatherData.weatherIcon}}.png></h3>
            Description<p>{{weatherData.weather_des}}</p>
          </div>
          <div class="bgImg"><img src="/static/Asset4.svg"></div>
        </div>
        </div>
          <div class = "weather_table">
          <div class='table-responsive' style="overflow-x:auto;">
        <!-- <div class="table-responsive"> -->
          <table class="table table-bordered table-dark" id="tb">
            <thead class = "thead-dark">
              <tr>
                
                <th scope="col">Start date</th>
                <th scope="col">Start Time</th>
                <th scope="col">End date</th>
                <th scope="col">End Time</th>
                <th scope="col">Title</th>
                <th scope="col">Description</th>
              </tr>
            </thead>
            <tbody>
              {% for i in data %}
              
              <tr class="trow">
                
                <td>{{i.start}}</td>
                <td>{{i.stTimeap}}</td>
                <td>{{i.end}}</td>
                <td>{{i.endTimeap}}</td>
                <td>{{i.title}}</td>
                <td>{{i.des}}</td>

              </tr>
              {% endfor %}
              <!-- <tr>
                <th scope="row">1</th>
                <td>Mark</td>
                <td>Otto</td>
                <td>@mdo</td>
              </tr>
              <tr>
                <th scope="row">2</th>
                <td>Jacob</td>
                <td>Thornton</td>
                <td>@fat</td>
              </tr>
              <tr>
                <th scope="row">3</th>
                <td colspan="2">Larry the Bird</td>
                <td>@twitter</td>
              </tr> -->
            </tbody>
          </table>
        </div>
        <!-- </div> -->

        </div>
      </div>
    </body>
</html>